"use strict";var app=angular.module("myApp",["ui.router","ui.router","satellizer","ui.bootstrap"]);app.config(["$authProvider",function(e){e.loginUrl="/api/users/login",e.signupUrl="/api/users/signup",e.facebook({clientId:"277768235911300",url:"/api/users/facebook"})}]),app.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",templateUrl:"/html/home.html",controller:"homeCtrl"}).state("register",{url:"/register",templateUrl:"/html/register.html",controller:"registerCtrl"}).state("login",{url:"/login",templateUrl:"/html/login.html",controller:"loginCtrl"}).state("search",{url:"/search/:name/:location",templateUrl:"/html/search.html",controller:"searchCtrl",resolve:{Businesses:["Business","$stateParams",function(e,t){return e.search(t.name)}]}}).state("details",{url:"/:yelpId",templateUrl:"/html/details.html",controller:"detailsCtrl",resolve:{Details:["Business","$stateParams",function(e,t){return e.details(t.yelpId)}]}}),t.otherwise("/")}]);var app=angular.module("myApp");app.controller("mainCtrl",["$scope","$state","$auth","$rootScope",function(e,t,o,s){e.isAuthenticated=function(){return o.isAuthenticated()},e.isAuthenticated()&&(s.currUser=o.getPayload()),e.logout=function(){o.logout(),t.go("home")}}]),app.controller("homeCtrl",["$scope","$state","Business",function(e,t,o){e.businessSearch=function(){t.go("search",{name:e.businessName,location:e.businessLocation})}}]),app.controller("searchCtrl",["$scope","$state","$stateParams","Businesses",function(e,t,o,s){console.log(s),e.businesses=s.businesses}]),app.controller("detailsCtrl",["$scope","$state","$stateParams","Details","Business","$rootScope","$auth",function(e,t,o,s,r,n,l){e.authenticated=!1,console.log("details ctrl"),console.log(s),e.details=s,e.details.favoriteCount&&l.isAuthenticated()&&(n.currUser=l.getPayload(),e.authenticated=!0,console.log("curr user",n),e.favorite=e.details.users.includes(n.currUser._id));e.favorite;e.toggleFavorite=function(t){t?r.addFavorite(e.details.yelpInfo).then(function(e){console.log(e.data)}):r.removeFavorite(e.details.yelpInfo).then(function(e){console.log(e.data)})}}]),app.controller("loginCtrl",["$scope","$state","$auth","$rootScope",function(e,t,o,s){e.login=function(){o.login(e.user).then(function(e){console.log("res",e),t.go("home")})["catch"](function(e){console.log("err",e)})}}]),app.controller("registerCtrl",["$scope","$state","$auth",function(e,t,o){e.register=function(){e.user.password!==e.user.password2?(e.user.password=null,e.user.password2=null,alert("Passwords do NOT match. Try again.")):o.signup(e.user).then(function(e){console.log("res",e),t.go("login")})["catch"](function(e){console.log("err",e)})}}]);var app=angular.module("myApp");app.service("Business",["$http","$q",function(e,t){this.search=function(t,o){return e.get("/api/businesses/search/"+t+"/"+o).then(function(e){return e.data})["catch"](function(e){e&&console.log(e)})},this.details=function(t){return e.get("/api/businesses/details/"+t).then(function(e){return console.log("details",e),e.data})["catch"](function(e){e&&console.log(e)})},this.addFavorite=function(t){return e.post("api/users/addFavorite",{yelpInfo:t})["catch"](function(e){e&&console.log(e)})},this.removeFavorite=function(t){return e.post("api/users/removeFavorite",{yelpInfo:t})["catch"](function(e){e&&console.log(e)})}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbnRyb2xsZXJzL2NvbnRyb2xsZXJzLmpzIiwic2VydmljZXMvc2VydmljZXMuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRhdXRoUHJvdmlkZXIiLCJsb2dpblVybCIsInNpZ251cFVybCIsImZhY2Vib29rIiwiY2xpZW50SWQiLCJ1cmwiLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicmVzb2x2ZSIsIkJ1c2luZXNzZXMiLCJCdXNpbmVzcyIsIiRzdGF0ZVBhcmFtcyIsInNlYXJjaCIsIm5hbWUiLCJEZXRhaWxzIiwiZGV0YWlscyIsInllbHBJZCIsIm90aGVyd2lzZSIsIiRzY29wZSIsIiRzdGF0ZSIsIiRhdXRoIiwiJHJvb3RTY29wZSIsImlzQXV0aGVudGljYXRlZCIsImN1cnJVc2VyIiwiZ2V0UGF5bG9hZCIsImxvZ291dCIsImdvIiwiYnVzaW5lc3NTZWFyY2giLCJidXNpbmVzc05hbWUiLCJsb2NhdGlvbiIsImJ1c2luZXNzTG9jYXRpb24iLCJjb25zb2xlIiwibG9nIiwiYnVzaW5lc3NlcyIsImF1dGhlbnRpY2F0ZWQiLCJmYXZvcml0ZUNvdW50IiwiZmF2b3JpdGUiLCJ1c2VycyIsImluY2x1ZGVzIiwiX2lkIiwidG9nZ2xlRmF2b3JpdGUiLCJ0b2dnbGUiLCJhZGRGYXZvcml0ZSIsInllbHBJbmZvIiwidGhlbiIsInJlcyIsImRhdGEiLCJyZW1vdmVGYXZvcml0ZSIsImxvZ2luIiwidXNlciIsImVyciIsInJlZ2lzdGVyIiwicGFzc3dvcmQiLCJwYXNzd29yZDIiLCJhbGVydCIsInNpZ251cCIsInNlcnZpY2UiLCIkaHR0cCIsIiRxIiwidGhpcyIsImdldCIsInBvc3QiXSwibWFwcGluZ3MiOiJBQUFBLFlBR0EsSUFBQUEsS0FBQUMsUUFBQUMsT0FBQSxTQUFBLFlBQUEsWUFBQSxhQUFB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Q0FqQyxFQUFBK0IsS0FBQUcsV0FBQWxDLEVBQUErQixLQUFBSSxXQUNBbkMsRUFBQStCLEtBQUFHLFNBQUEsS0FDQWxDLEVBQUErQixLQUFBSSxVQUFBLEtBQ0FDLE1BQUEsdUNBR0FsQyxFQUFBbUMsT0FBQXJDLEVBQUErQixNQUNBTCxLQUFBLFNBQUFDLEdBQ0FkLFFBQUFDLElBQUEsTUFBQWEsR0FDQTFCLEVBQUFPLEdBQUEsV0FIQU4sU0FLQSxTQUFBOEIsR0FDQW5CLFFBQUFDLElBQUEsTUFBQWtCLFFDbkhBLElBQUF6RCxLQUFBQyxRQUFBQyxPQUFBLFFBRUFGLEtBQUErRCxRQUFBLFlBQUEsUUFBQSxLQUFBLFNBQUFDLEVBQUFDLEdBQ0FDLEtBQUEvQyxPQUFBLFNBQUFDLEVBQUFnQixHQUNBLE1BQUE0QixHQUFBRyxJQUFBLDBCQUFBL0MsRUFBQSxJQUFBZ0IsR0FDQWUsS0FBQSxTQUFBQyxHQUNBLE1BQUFBLEdBQUFDLE9BRkFXLFNBSUEsU0FBQVAsR0FDQUEsR0FBQW5CLFFBQUFDLElBQUFrQixNQUlBUyxLQUFBNUMsUUFBQSxTQUFBQyxHQUNBLE1BQUF5QyxHQUFBRyxJQUFBLDJCQUFBNUMsR0FDQTRCLEtBQUEsU0FBQUMsR0FFQSxNQURBZCxTQUFBQyxJQUFBLFVBQUFhLEdBQ0FBLEVBQUFDLE9BSEFXLFNBS0EsU0FBQVAsR0FDQUEsR0FBQW5CLFFBQUFDLElBQUFrQixNQUlBUyxLQUFBakIsWUFBQSxTQUFBQyxHQUNBLE1BQUFjLEdBQUFJLEtBQUEseUJBQUFsQixTQUFBQSxJQUFBYyxTQUNBLFNBQUFQLEdBQ0FBLEdBQUFuQixRQUFBQyxJQUFBa0IsTUFHQVMsS0FBQVosZUFBQSxTQUFBSixHQUNBLE1BQUFjLEdBQUFJLEtBQUEsNEJBQUFsQixTQUFBQSxJQUFBYyxTQUNBLFNBQUFQLEdBQ0FBLEdBQUFuQixRQUFBQyxJQUFBa0IiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnLCBbJ3VpLnJvdXRlcicsICd1aS5yb3V0ZXInLCAnc2F0ZWxsaXplcicsICd1aS5ib290c3RyYXAnXSk7XG5cbmFwcC5jb25maWcoZnVuY3Rpb24oJGF1dGhQcm92aWRlcikge1xuICAkYXV0aFByb3ZpZGVyLmxvZ2luVXJsID0gJy9hcGkvdXNlcnMvbG9naW4nO1xuICAkYXV0aFByb3ZpZGVyLnNpZ251cFVybCA9ICcvYXBpL3VzZXJzL3NpZ251cCc7XG5cbiAgJGF1dGhQcm92aWRlci5mYWNlYm9vayh7XG4gICAgY2xpZW50SWQ6ICcyNzc3NjgyMzU5MTEzMDAnLFxuICAgIHVybDogJy9hcGkvdXNlcnMvZmFjZWJvb2snXG4gIH0pO1xuXG59KTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbigkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG5cbiAgJHN0YXRlUHJvdmlkZXJcbiAgICAuc3RhdGUoJ2hvbWUnLCB7XG4gICAgICB1cmw6ICcvJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvaG9tZS5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdob21lQ3RybCdcbiAgICB9KVxuICAgIC5zdGF0ZSgncmVnaXN0ZXInLCB7XG4gICAgICB1cmw6ICcvcmVnaXN0ZXInLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9yZWdpc3Rlci5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWdpc3RlckN0cmwnXG4gICAgfSlcbiAgICAuc3RhdGUoJ2xvZ2luJywge1xuICAgICAgdXJsOiAnL2xvZ2luJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvbG9naW4uaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnbG9naW5DdHJsJ1xuICAgIH0pXG4gICAgLnN0YXRlKCdzZWFyY2gnLCB7XG4gICAgICB1cmw6ICcvc2VhcmNoLzpuYW1lLzpsb2NhdGlvbicsIFxuICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9zZWFyY2guaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnc2VhcmNoQ3RybCcsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIEJ1c2luZXNzZXM6IGZ1bmN0aW9uKEJ1c2luZXNzLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICByZXR1cm4gQnVzaW5lc3Muc2VhcmNoKCRzdGF0ZVBhcmFtcy5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICAgLnN0YXRlKCdkZXRhaWxzJyAsIHtcbiAgICAgIHVybDogJy86eWVscElkJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvZGV0YWlscy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdkZXRhaWxzQ3RybCcsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIERldGFpbHM6IGZ1bmN0aW9uKEJ1c2luZXNzLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICByZXR1cm4gQnVzaW5lc3MuZGV0YWlscygkc3RhdGVQYXJhbXMueWVscElkKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSlcblxuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG59KSIsIid1c2Ugc3RyaWN0JztcblxuXG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuXG5cblxuYXBwLmNvbnRyb2xsZXIoJ21haW5DdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRhdXRoLCAkcm9vdFNjb3BlKSB7XG4gIC8vIGNvbnNvbGUubG9nKCdtYWluQ3RybCEnKTtcblxuICAkc2NvcGUuaXNBdXRoZW50aWNhdGVkID0gKCkgPT4gJGF1dGguaXNBdXRoZW50aWNhdGVkKCk7XG5cbiAgaWYgKCRzY29wZS5pc0F1dGhlbnRpY2F0ZWQoKSkge1xuICAgICRyb290U2NvcGUuY3VyclVzZXIgPSAkYXV0aC5nZXRQYXlsb2FkKCk7XG4gIH1cbiAgJHNjb3BlLmxvZ291dCA9ICgpID0+IHtcbiAgICAkYXV0aC5sb2dvdXQoKTtcbiAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgfTtcblxuICAvLyAkc2NvcGUuYXV0aGVudGljYXRlID0gcHJvdmlkZXIgPT4ge1xuICAvLyAgICRhdXRoLmF1dGhlbnRpY2F0ZShwcm92aWRlcilcbiAgLy8gICAgIC50aGVuKHJlcyA9PiB7XG4gIC8vICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuICAvLyAgICAgfSlcbiAgLy8gICAgIC5jYXRjaChlcnIgPT4ge1xuICAvLyAgICAgICBjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG4gIC8vICAgICB9KTtcbiAgLy8gfTtcblxufSk7XG5cbmFwcC5jb250cm9sbGVyKCdob21lQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBCdXNpbmVzcykge1xuICAkc2NvcGUuYnVzaW5lc3NTZWFyY2ggPSAoKSA9PiB7XG4gICAgICAgICRzdGF0ZS5nbygnc2VhcmNoJywge25hbWU6ICRzY29wZS5idXNpbmVzc05hbWUsIGxvY2F0aW9uOiAkc2NvcGUuYnVzaW5lc3NMb2NhdGlvbn0pO1xuICB9O1xufSk7XG5cblxuYXBwLmNvbnRyb2xsZXIoJ3NlYXJjaEN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCBCdXNpbmVzc2VzKSB7XG4gIGNvbnNvbGUubG9nKEJ1c2luZXNzZXMpO1xuICAkc2NvcGUuYnVzaW5lc3NlcyA9IEJ1c2luZXNzZXMuYnVzaW5lc3NlcztcblxufSk7XG5cblxuYXBwLmNvbnRyb2xsZXIoJ2RldGFpbHNDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgRGV0YWlscywgQnVzaW5lc3MsJHJvb3RTY29wZSwgJGF1dGgpIHtcbiAgJHNjb3BlLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTtcbiAgY29uc29sZS5sb2coJ2RldGFpbHMgY3RybCcpO1xuICBjb25zb2xlLmxvZyhEZXRhaWxzKTtcbiAgJHNjb3BlLmRldGFpbHMgPSBEZXRhaWxzO1xuXG4gIGlmKCRzY29wZS5kZXRhaWxzLmZhdm9yaXRlQ291bnQgJiYgJGF1dGguaXNBdXRoZW50aWNhdGVkKCkpIHtcbiAgICAkcm9vdFNjb3BlLmN1cnJVc2VyID0gJGF1dGguZ2V0UGF5bG9hZCgpO1xuICAgICRzY29wZS5hdXRoZW50aWNhdGVkID0gdHJ1ZTtcbiAgICBjb25zb2xlLmxvZygnY3VyciB1c2VyJywkcm9vdFNjb3BlKTtcbiAgICAkc2NvcGUuZmF2b3JpdGUgPSAkc2NvcGUuZGV0YWlscy51c2Vycy5pbmNsdWRlcygkcm9vdFNjb3BlLmN1cnJVc2VyLl9pZCk7XG4gIH1cbiAgbGV0IGZhdm9yaXRlID0gJHNjb3BlLmZhdm9yaXRlO1xuICAkc2NvcGUudG9nZ2xlRmF2b3JpdGUgPSAodG9nZ2xlKSA9PiB7XG4gICAgXG4gICAgaWYodG9nZ2xlKSB7XG4gICAgICBCdXNpbmVzcy5hZGRGYXZvcml0ZSgkc2NvcGUuZGV0YWlscy55ZWxwSW5mbylcbiAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBCdXNpbmVzcy5yZW1vdmVGYXZvcml0ZSgkc2NvcGUuZGV0YWlscy55ZWxwSW5mbylcbiAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSk7XG4gICAgICAgIH0pXG4gICAgfVxuICB9O1xuXG5cblxufSk7XG5cbmFwcC5jb250cm9sbGVyKCdsb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJGF1dGgsICRyb290U2NvcGUpIHtcbiAgLy8gY29uc29sZS5sb2coJ2xvZ2luQ3RybCEnKTtcblxuICAkc2NvcGUubG9naW4gPSAoKSA9PiB7XG4gICAgJGF1dGgubG9naW4oJHNjb3BlLnVzZXIpXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygncmVzJywgcmVzKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJGF1dGguZ2V0UGF5bG9hZCgpKTtcblxuICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycik7XG4gICAgICB9KVxuXG4gIH07XG5cbn0pO1xuXG5cblxuYXBwLmNvbnRyb2xsZXIoJ3JlZ2lzdGVyQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCAkYXV0aCkge1xuICAvLyBjb25zb2xlLmxvZygncmVnaXN0ZXJDdHJsIScpO1xuXG4gICRzY29wZS5yZWdpc3RlciA9ICgpID0+IHtcbiAgICBpZiAoJHNjb3BlLnVzZXIucGFzc3dvcmQgIT09ICRzY29wZS51c2VyLnBhc3N3b3JkMikge1xuICAgICAgJHNjb3BlLnVzZXIucGFzc3dvcmQgPSBudWxsO1xuICAgICAgJHNjb3BlLnVzZXIucGFzc3dvcmQyID0gbnVsbDtcbiAgICAgIGFsZXJ0KCdQYXNzd29yZHMgZG8gTk9UIG1hdGNoLiBUcnkgYWdhaW4uJylcbiAgICB9IGVsc2Uge1xuXG4gICAgICAkYXV0aC5zaWdudXAoJHNjb3BlLnVzZXIpXG4gICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3JlcycsIHJlcyk7XG4gICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnZXJyJywgZXJyKTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgfTtcblxufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ215QXBwJyk7XG5cbmFwcC5zZXJ2aWNlKCdCdXNpbmVzcycsIGZ1bmN0aW9uKCRodHRwLCAkcSkge1xuICB0aGlzLnNlYXJjaCA9IChuYW1lLCBsb2NhdGlvbikgPT4ge1xuICAgIHJldHVybiAkaHR0cC5nZXQoYC9hcGkvYnVzaW5lc3Nlcy9zZWFyY2gvJHtuYW1lfS8ke2xvY2F0aW9ufWApXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICByZXR1cm4gcmVzLmRhdGE7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGlmIChlcnIpIGNvbnNvbGUubG9nKGVycik7XG4gICAgICB9KTtcblxuICB9O1xuICB0aGlzLmRldGFpbHMgPSAoeWVscElkKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLmdldChgL2FwaS9idXNpbmVzc2VzL2RldGFpbHMvJHt5ZWxwSWR9YClcbiAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdkZXRhaWxzJywgcmVzKTtcbiAgICAgICAgcmV0dXJuIHJlcy5kYXRhO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICBpZiAoZXJyKSBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgfSk7XG4gIH07XG5cbiAgdGhpcy5hZGRGYXZvcml0ZSA9ICh5ZWxwSW5mbykgPT4ge1xuICAgIHJldHVybiAkaHR0cC5wb3N0KCdhcGkvdXNlcnMvYWRkRmF2b3JpdGUnLCB7IHllbHBJbmZvIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgaWYgKGVycikgY29uc29sZS5sb2coZXJyKTtcbiAgICAgIH0pO1xuICB9XG4gIHRoaXMucmVtb3ZlRmF2b3JpdGUgPSAoeWVscEluZm8pID0+IHtcbiAgICByZXR1cm4gJGh0dHAucG9zdCgnYXBpL3VzZXJzL3JlbW92ZUZhdm9yaXRlJywgeyB5ZWxwSW5mbyB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGlmIChlcnIpIGNvbnNvbGUubG9nKGVycik7XG4gICAgICB9KTtcbiAgfVxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
