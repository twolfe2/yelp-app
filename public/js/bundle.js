"use strict";var app=angular.module("myApp",["ui.router","ui.router","satellizer","ui.bootstrap"]);app.config(["$authProvider",function(t){t.loginUrl="/api/users/login",t.signupUrl="/api/users/signup",t.facebook({clientId:"277768235911300",url:"/api/users/facebook"})}]),app.config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/",templateUrl:"/html/home.html",controller:"homeCtrl"}).state("favorites",{url:"/favorites",templateUrl:"/html/favorites.html",controller:"favoritesCtrl",resolve:{Favorites:["User",function(t){return t.getFavorites()}]}}).state("register",{url:"/register",templateUrl:"/html/register.html",controller:"registerCtrl"}).state("login",{url:"/login",templateUrl:"/html/login.html",controller:"loginCtrl"}).state("search",{url:"/search/:name/:location",templateUrl:"/html/search.html",controller:"searchCtrl",resolve:{Businesses:["Business","$stateParams",function(t,e){return t.search(e.name)}]}}).state("details",{url:"/:yelpId",templateUrl:"/html/details.html",controller:"detailsCtrl",resolve:{Details:["Business","$stateParams",function(t,e){return t.details(e.yelpId)}]}}),e.otherwise("/")}]);var app=angular.module("myApp");app.controller("favoritesCtrl",["$scope","Favorites",function(t,e){t.favorites=e}]),app.controller("mainCtrl",["$scope","$state","$auth","$rootScope",function(t,e,o,r){t.isAuthenticated=function(){return o.isAuthenticated()},t.isAuthenticated()&&(r.currUser=o.getPayload()),t.logout=function(){o.logout(),e.go("home")}}]),app.controller("homeCtrl",["$scope","$state","Business",function(t,e,o){t.loading=!1,t.businessSearch=function(){t.loading=!0,e.go("search",{name:t.businessName,location:t.businessLocation})}}]),app.controller("searchCtrl",["$scope","$state","$stateParams","Businesses",function(t,e,o,r){console.log(r),t.businesses=r.businesses}]),app.controller("detailsCtrl",["$scope","$state","$stateParams","Details","Business","$rootScope","$auth",function(t,e,o,r,s,n,a){t.authenticated=!1,a.isAuthenticated()&&(t.authenticated=!0),console.log("details ctrl"),console.log(r),t.details=r,t.details.favoriteCount&&a.isAuthenticated()&&(n.currUser=a.getPayload(),t.authenticated=!0,console.log("curr user",n),t.favorite=t.details.users.includes(n.currUser._id));t.favorite;t.toggleFavorite=function(e){e?s.addFavorite(t.details.yelpInfo).then(function(e){console.log(e.data),t.details.favoriteCount=e.data.favoriteCount}):s.removeFavorite(t.details.yelpInfo).then(function(e){console.log(e.data),t.details.favoriteCount=e.data.favoriteCount})}}]),app.controller("loginCtrl",["$scope","$state","$auth","$rootScope",function(t,e,o,r){t.login=function(){o.login(t.user).then(function(t){console.log("res",t),e.go("home")})["catch"](function(t){console.log("err",t)})}}]),app.controller("registerCtrl",["$scope","$state","$auth",function(t,e,o){t.register=function(){t.user.password!==t.user.password2?(t.user.password=null,t.user.password2=null,alert("Passwords do NOT match. Try again.")):o.signup(t.user).then(function(t){console.log("res",t),e.go("login")})["catch"](function(t){console.log("err",t)})}}]);var app=angular.module("myApp");app.service("Business",["$http","$q",function(t,e){this.search=function(e,o){return t.get("api/businesses/search/"+e+"/"+o).then(function(t){return t.data})["catch"](function(t){t&&console.log(t)})},this.details=function(e){return t.get("api/businesses/details/"+e).then(function(t){return console.log("details",t),t.data})["catch"](function(t){t&&console.log(t)})},this.addFavorite=function(e){return t.post("api/users/addFavorite",{yelpInfo:e})["catch"](function(t){t&&console.log(t)})},this.removeFavorite=function(e){return t.post("api/users/removeFavorite",{yelpInfo:e})["catch"](function(t){t&&console.log(t)})}}]),app.service("User",["$http",function(t){this.getFavorites=function(){return t.get("api/users/favorites").then(function(t){return console.log("details",t),t.data.favorites})["catch"](function(t){t&&console.log(t)})}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbnRyb2xsZXJzL2NvbnRyb2xsZXJzLmpzIiwic2VydmljZXMvc2VydmljZXMuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRhdXRoUHJvdmlkZXIiLCJsb2dpblVybCIsInNpZ251cFVybCIsImZhY2Vib29rIiwiY2xpZW50SWQiLCJ1cmwiLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicmVzb2x2ZSIsIkZhdm9yaXRlcyIsIlVzZXIiLCJnZXRGYXZvcml0ZXMiLCJCdXNpbmVzc2VzIiwiQnVzaW5lc3MiLCIkc3RhdGVQYXJhbXMiLCJzZWFyY2giLCJuYW1lIiwiRGV0YWlscyIsImRldGFpbHMiLCJ5ZWxwSWQiLCJvdGhlcndpc2UiLCIkc2NvcGUiLCJmYXZvcml0ZXMiLCIkc3RhdGUiLCIkYXV0aCIsIiRyb290U2NvcGUiLCJpc0F1dGhlbnRpY2F0ZWQiLCJjdXJyVXNlciIsImdldFBheWxvYWQiLCJsb2dvdXQiLCJnbyIsImxvYWRpbmciLCJidXNpbmVzc1NlYXJjaCIsImJ1c2luZXNzTmFtZSIsImxvY2F0aW9uIiwiYnVzaW5lc3NMb2NhdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJidXNpbmVzc2VzIiwiYXV0aGVudGljYXRlZCIsImZhdm9yaXRlQ291bnQiLCJmYXZvcml0ZSIsInVzZXJzIiwiaW5jbHVkZXMiLCJfaWQiLCJ0b2dnbGVGYXZvcml0ZSIsInRvZ2dsZSIsImFkZEZhdm9yaXRlIiwieWVscEluZm8iLCJ0aGVuIiwicmVzIiwiZGF0YSIsInJlbW92ZUZhdm9yaXRlIiwibG9naW4iLCJ1c2VyIiwiZXJyIiwicmVnaXN0ZXIiLCJwYXNzd29yZCIsInBhc3N3b3JkMiIsImFsZXJ0Iiwic2lnbnVwIiwic2VydmljZSIsIiRodHRwIiwiJHEiLCJ0aGlzIiwiZ2V0IiwicG9zdCJdLCJtYXBwaW5n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QUFDLElBQUEsVUFBQWEsR0FDQUEsRUFBQUMsT0FIQVcsU0FLQSxTQUFBUCxHQUNBQSxHQUFBbkIsUUFBQUMsSUFBQWtCLE1BSUFTLEtBQUFqQixZQUFBLFNBQUFDLEdBQ0EsTUFBQWMsR0FBQUksS0FBQSx5QkFBQWxCLFNBQUFBLElBQUFjLFNBQ0EsU0FBQVAsR0FDQUEsR0FBQW5CLFFBQUFDLElBQUFrQixNQUdBUyxLQUFBWixlQUFBLFNBQUFKLEdBQ0EsTUFBQWMsR0FBQUksS0FBQSw0QkFBQWxCLFNBQUFBLElBQUFjLFNBQ0EsU0FBQVAsR0FDQUEsR0FBQW5CLFFBQUFDLElBQUFrQixTQU1BOUQsSUFBQW9FLFFBQUEsUUFBQSxRQUFBLFNBQUFDLEdBQ0FFLEtBQUFyRCxhQUFBLFdBRUEsTUFBQW1ELEdBQUFHLElBQUEsdUJBQ0FoQixLQUFBLFNBQUFDLEdBRUEsTUFEQWQsU0FBQUMsSUFBQSxVQUFBYSxHQUNBQSxFQUFBQyxLQUFBN0IsWUFIQXdDLFNBS0EsU0FBQVAsR0FDQUEsR0FBQW5CLFFBQUFDLElBQUFrQiIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcsIFsndWkucm91dGVyJywgJ3VpLnJvdXRlcicsICdzYXRlbGxpemVyJywgJ3VpLmJvb3RzdHJhcCddKTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbigkYXV0aFByb3ZpZGVyKSB7XG4gICRhdXRoUHJvdmlkZXIubG9naW5VcmwgPSAnL2FwaS91c2Vycy9sb2dpbic7XG4gICRhdXRoUHJvdmlkZXIuc2lnbnVwVXJsID0gJy9hcGkvdXNlcnMvc2lnbnVwJztcblxuICAkYXV0aFByb3ZpZGVyLmZhY2Vib29rKHtcbiAgICBjbGllbnRJZDogJzI3Nzc2ODIzNTkxMTMwMCcsXG4gICAgdXJsOiAnL2FwaS91c2Vycy9mYWNlYm9vaydcbiAgfSk7XG5cbn0pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcblxuICAkc3RhdGVQcm92aWRlclxuICAgIC5zdGF0ZSgnaG9tZScsIHtcbiAgICAgIHVybDogJy8nLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9ob21lLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ2hvbWVDdHJsJ1xuICAgIH0pXG4gICAgLnN0YXRlKCdmYXZvcml0ZXMnLCB7XG4gICAgICB1cmw6ICcvZmF2b3JpdGVzJywgXG4gICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2Zhdm9yaXRlcy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdmYXZvcml0ZXNDdHJsJyxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgRmF2b3JpdGVzOiBmdW5jdGlvbihVc2VyKSB7XG4gICAgICAgICAgcmV0dXJuIFVzZXIuZ2V0RmF2b3JpdGVzKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgncmVnaXN0ZXInLCB7XG4gICAgICB1cmw6ICcvcmVnaXN0ZXInLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9yZWdpc3Rlci5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWdpc3RlckN0cmwnXG4gICAgfSlcbiAgICAuc3RhdGUoJ2xvZ2luJywge1xuICAgICAgdXJsOiAnL2xvZ2luJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvbG9naW4uaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnbG9naW5DdHJsJ1xuICAgIH0pXG4gICAgLnN0YXRlKCdzZWFyY2gnLCB7XG4gICAgICB1cmw6ICcvc2VhcmNoLzpuYW1lLzpsb2NhdGlvbicsIFxuICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9zZWFyY2guaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnc2VhcmNoQ3RybCcsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIEJ1c2luZXNzZXM6IGZ1bmN0aW9uKEJ1c2luZXNzLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICByZXR1cm4gQnVzaW5lc3Muc2VhcmNoKCRzdGF0ZVBhcmFtcy5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICAgLnN0YXRlKCdkZXRhaWxzJyAsIHtcbiAgICAgIHVybDogJy86eWVscElkJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvZGV0YWlscy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdkZXRhaWxzQ3RybCcsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIERldGFpbHM6IGZ1bmN0aW9uKEJ1c2luZXNzLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICByZXR1cm4gQnVzaW5lc3MuZGV0YWlscygkc3RhdGVQYXJhbXMueWVscElkKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSlcblxuXG4gICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbn0pIiwiJ3VzZSBzdHJpY3QnO1xuXG5cblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcpO1xuXG5cbmFwcC5jb250cm9sbGVyKCdmYXZvcml0ZXNDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBGYXZvcml0ZXMpIHtcbiAgJHNjb3BlLmZhdm9yaXRlcyA9IEZhdm9yaXRlcztcbn0pXG5cblxuYXBwLmNvbnRyb2xsZXIoJ21haW5DdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRhdXRoLCAkcm9vdFNjb3BlKSB7XG4gIC8vIGNvbnNvbGUubG9nKCdtYWluQ3RybCEnKTtcblxuICAkc2NvcGUuaXNBdXRoZW50aWNhdGVkID0gKCkgPT4gJGF1dGguaXNBdXRoZW50aWNhdGVkKCk7XG5cbiAgaWYgKCRzY29wZS5pc0F1dGhlbnRpY2F0ZWQoKSkge1xuICAgICRyb290U2NvcGUuY3VyclVzZXIgPSAkYXV0aC5nZXRQYXlsb2FkKCk7XG4gIH1cbiAgJHNjb3BlLmxvZ291dCA9ICgpID0+IHtcbiAgICAkYXV0aC5sb2dvdXQoKTtcbiAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICBcbiAgfTtcblxuICAvLyAkc2NvcGUuYXV0aGVudGljYXRlID0gcHJvdmlkZXIgPT4ge1xuICAvLyAgICRhdXRoLmF1dGhlbnRpY2F0ZShwcm92aWRlcilcbiAgLy8gICAgIC50aGVuKHJlcyA9PiB7XG4gIC8vICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuICAvLyAgICAgfSlcbiAgLy8gICAgIC5jYXRjaChlcnIgPT4ge1xuICAvLyAgICAgICBjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG4gIC8vICAgICB9KTtcbiAgLy8gfTtcblxufSk7XG5cbmFwcC5jb250cm9sbGVyKCdob21lQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBCdXNpbmVzcykge1xuICAkc2NvcGUubG9hZGluZz1mYWxzZTtcbiAgJHNjb3BlLmJ1c2luZXNzU2VhcmNoID0gKCkgPT4ge1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgICRzdGF0ZS5nbygnc2VhcmNoJywge25hbWU6ICRzY29wZS5idXNpbmVzc05hbWUsIGxvY2F0aW9uOiAkc2NvcGUuYnVzaW5lc3NMb2NhdGlvbn0pO1xuICB9O1xufSk7XG5cblxuYXBwLmNvbnRyb2xsZXIoJ3NlYXJjaEN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCBCdXNpbmVzc2VzKSB7XG4gIGNvbnNvbGUubG9nKEJ1c2luZXNzZXMpO1xuICAkc2NvcGUuYnVzaW5lc3NlcyA9IEJ1c2luZXNzZXMuYnVzaW5lc3NlcztcblxufSk7XG5cblxuYXBwLmNvbnRyb2xsZXIoJ2RldGFpbHNDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgRGV0YWlscywgQnVzaW5lc3MsJHJvb3RTY29wZSwgJGF1dGgpIHtcbiAgJHNjb3BlLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTtcbiAgaWYoJGF1dGguaXNBdXRoZW50aWNhdGVkKCkpIHtcbiAgICAkc2NvcGUuYXV0aGVudGljYXRlZCA9IHRydWU7XG4gIH1cbiAgY29uc29sZS5sb2coJ2RldGFpbHMgY3RybCcpO1xuICBjb25zb2xlLmxvZyhEZXRhaWxzKTtcbiAgJHNjb3BlLmRldGFpbHMgPSBEZXRhaWxzO1xuXG4gIGlmKCRzY29wZS5kZXRhaWxzLmZhdm9yaXRlQ291bnQgJiYgJGF1dGguaXNBdXRoZW50aWNhdGVkKCkpIHtcbiAgICAkcm9vdFNjb3BlLmN1cnJVc2VyID0gJGF1dGguZ2V0UGF5bG9hZCgpO1xuICAgICRzY29wZS5hdXRoZW50aWNhdGVkID0gdHJ1ZTtcbiAgICBjb25zb2xlLmxvZygnY3VyciB1c2VyJywkcm9vdFNjb3BlKTtcbiAgICAkc2NvcGUuZmF2b3JpdGUgPSAkc2NvcGUuZGV0YWlscy51c2Vycy5pbmNsdWRlcygkcm9vdFNjb3BlLmN1cnJVc2VyLl9pZCk7XG4gIH1cbiAgbGV0IGZhdm9yaXRlID0gJHNjb3BlLmZhdm9yaXRlO1xuICAkc2NvcGUudG9nZ2xlRmF2b3JpdGUgPSAodG9nZ2xlKSA9PiB7XG4gICAgXG4gICAgaWYodG9nZ2xlKSB7XG4gICAgICBCdXNpbmVzcy5hZGRGYXZvcml0ZSgkc2NvcGUuZGV0YWlscy55ZWxwSW5mbylcbiAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSk7XG4gICAgICAgICAgJHNjb3BlLmRldGFpbHMuZmF2b3JpdGVDb3VudCA9IHJlcy5kYXRhLmZhdm9yaXRlQ291bnQ7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBCdXNpbmVzcy5yZW1vdmVGYXZvcml0ZSgkc2NvcGUuZGV0YWlscy55ZWxwSW5mbylcbiAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YSk7XG4gICAgICAgICAgJHNjb3BlLmRldGFpbHMuZmF2b3JpdGVDb3VudCA9IHJlcy5kYXRhLmZhdm9yaXRlQ291bnQ7XG4gICAgICAgIH0pXG4gICAgfVxuICB9O1xuXG5cblxufSk7XG5cblxuXG5hcHAuY29udHJvbGxlcignbG9naW5DdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRhdXRoLCAkcm9vdFNjb3BlKSB7XG4gIC8vIGNvbnNvbGUubG9nKCdsb2dpbkN0cmwhJyk7XG5cbiAgJHNjb3BlLmxvZ2luID0gKCkgPT4ge1xuICAgICRhdXRoLmxvZ2luKCRzY29wZS51c2VyKVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ3JlcycsIHJlcyk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCRhdXRoLmdldFBheWxvYWQoKSk7XG5cbiAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnInLCBlcnIpO1xuICAgICAgfSlcblxuICB9O1xuXG59KTtcblxuXG5cbmFwcC5jb250cm9sbGVyKCdyZWdpc3RlckN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJGF1dGgpIHtcbiAgLy8gY29uc29sZS5sb2coJ3JlZ2lzdGVyQ3RybCEnKTtcblxuICAkc2NvcGUucmVnaXN0ZXIgPSAoKSA9PiB7XG4gICAgaWYgKCRzY29wZS51c2VyLnBhc3N3b3JkICE9PSAkc2NvcGUudXNlci5wYXNzd29yZDIpIHtcbiAgICAgICRzY29wZS51c2VyLnBhc3N3b3JkID0gbnVsbDtcbiAgICAgICRzY29wZS51c2VyLnBhc3N3b3JkMiA9IG51bGw7XG4gICAgICBhbGVydCgnUGFzc3dvcmRzIGRvIE5PVCBtYXRjaC4gVHJ5IGFnYWluLicpXG4gICAgfSBlbHNlIHtcblxuICAgICAgJGF1dGguc2lnbnVwKCRzY29wZS51c2VyKVxuICAgICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXMnLCByZXMpO1xuICAgICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycik7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gIH07XG5cbn0pOyIsIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcpO1xuXG5hcHAuc2VydmljZSgnQnVzaW5lc3MnLCBmdW5jdGlvbigkaHR0cCwgJHEpIHtcbiAgdGhpcy5zZWFyY2ggPSAobmFtZSwgbG9jYXRpb24pID0+IHtcbiAgICByZXR1cm4gJGh0dHAuZ2V0KGBhcGkvYnVzaW5lc3Nlcy9zZWFyY2gvJHtuYW1lfS8ke2xvY2F0aW9ufWApXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICByZXR1cm4gcmVzLmRhdGE7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGlmIChlcnIpIGNvbnNvbGUubG9nKGVycik7XG4gICAgICB9KTtcblxuICB9O1xuICB0aGlzLmRldGFpbHMgPSAoeWVscElkKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLmdldChgYXBpL2J1c2luZXNzZXMvZGV0YWlscy8ke3llbHBJZH1gKVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2RldGFpbHMnLCByZXMpO1xuICAgICAgICByZXR1cm4gcmVzLmRhdGE7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGlmIChlcnIpIGNvbnNvbGUubG9nKGVycik7XG4gICAgICB9KTtcbiAgfTtcblxuICB0aGlzLmFkZEZhdm9yaXRlID0gKHllbHBJbmZvKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJ2FwaS91c2Vycy9hZGRGYXZvcml0ZScsIHsgeWVscEluZm8gfSlcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICBpZiAoZXJyKSBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgfSk7XG4gIH1cbiAgdGhpcy5yZW1vdmVGYXZvcml0ZSA9ICh5ZWxwSW5mbykgPT4ge1xuICAgIHJldHVybiAkaHR0cC5wb3N0KCdhcGkvdXNlcnMvcmVtb3ZlRmF2b3JpdGUnLCB7IHllbHBJbmZvIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgaWYgKGVycikgY29uc29sZS5sb2coZXJyKTtcbiAgICAgIH0pO1xuICB9XG59KTtcblxuXG5hcHAuc2VydmljZSgnVXNlcicsIGZ1bmN0aW9uKCRodHRwKSB7XG4gIHRoaXMuZ2V0RmF2b3JpdGVzID0gKCkgPT4ge1xuXG4gICAgcmV0dXJuICRodHRwLmdldCgnYXBpL3VzZXJzL2Zhdm9yaXRlcycpXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnZGV0YWlscycsIHJlcyk7XG4gICAgICAgIHJldHVybiByZXMuZGF0YS5mYXZvcml0ZXM7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGlmIChlcnIpIGNvbnNvbGUubG9nKGVycik7XG4gICAgICB9KTtcblxuICB9XG5cbn0pXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
